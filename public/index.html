<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="index.css">

  <title>Raven - Messaging App</title>
</head>

<body>

  <div id="Account_Created">
    <p class="notif_text">Account Created! Please sign in</p>
    <img class="notif_warn" src="Images/warning.png">

  </div>

  <div id="Signed_In">
    <p class="notif_text">Successfully signed in!</p>
    <img class="notif_warn" src="Images/warning.png">
  </div>

  <div id="Loader_Area">
    <div id="loader_login" class="loader_login"></div>
  </div>

  <div id="Login_Area">
    <video id="Login_Video" autoplay muted loop>
      <source src="Videos/blue.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <img id="Logo_Sign" src="Images/Logo_Large.png">
    <p id="SignIn_Title">Sign in to Raven</p>
    <p id="CreateAcc_Title">Create Account</p>
    <div id="Login_Container">
      <p id="email_Login_text" class="Sign_create_text">Username</p>
      <input id="Login_Email_Input" class="sign_create_input" type="text">

      <p id="Forgot_Pass">Forgot password?</p>
      <p id="pass_Login_text" class="Sign_create_text">Password</p>
      <input id="Login_pass_Input" class="sign_create_input" type="password">

      <img id="Pass_Notice_Login_Img" class="Notice_Img" src="Images/notice.png">
      <p id="Pass_Wrong_Login_Notice" class="Notice_text">Pasword or username is incorrect</p>

      <button id="Sign_In_Button" onclick="Sign_In()">Sign in</button>
    </div>
    <div id="Create_Container">
      <p id="email_Login_text" class="Sign_create_text">Username</p>
      <input id="Create_Email_Input" class="sign_create_input" type="text">

      <img id="Pass_Notice_Create_Img" class="Notice_Img" src="Images/notice.png">
      <p id="Pass_Wrong_Create_Notice" class="Notice_text">Account with that username already exists</p>
      <p id="Pass_Fail_Create_Notice" class="Notice_text">Account creation failed</p>
      <p id="pass_Login_text" class="Sign_create_text">Password</p>
      <input id="Create_pass_Input" class="sign_create_input" type="password">
      <p id="Repass_Login_text" class="Sign_create_text">Re-enter password</p>
      <input id="Create_Repass_Input" class="sign_create_input" type="password">
      <button id="Create_Acc_Button" onclick="Creating_Account()">Create account</button>
    </div>
    <div id="Switch_Tabs">
      <p id="New_Raven_text">New to Raven? <span id="Switch_Create_Account" onclick="Switch_Create_Account()">Create an
          account</span></p>
      <p id="Login_Raven_text">Already have an account? <span id="Switch_Log_In" onclick="Switch_Log_In()">Sign
          In</span></p>
    </div>

    <div id="Bottom_Links_Container">
      <p class="Bottom_Links">Terms</p>
      <p class="Bottom_Links">Privacy</p>
      <p class="Bottom_Links">Docs</p>
      <p class="Bottom_Links">Contact Support</p>
    </div>
  </div>


  <!--Settings Tab-->
  <div id="Settings_Tab">
    <img id="Exit_Settings" onclick="Close_Settings()" src="Images/Exit.png">
  </div>
  <!--Settings Tab-->



  <!--Confirm Connect-->
  <div id="Confirm_Connection">
    <img id="Warning_Connect_Img" src="Images/warning.png">
    <p id="Chat_Request_text"><span id="Chat_Request_actual">dasqe23e2d</span>has invited you to chat.</p>
    <div id="Button_Connect_Container">
      <button id="Join_Chat">Accept</button>
      <button id="Deny_Chat" onclick="deny_connection()">Deny</button>
    </div>

  </div>
  <!--Confirm Connect-->



  <!--Connection Notifs-->
  <div id="Connected_1" class="connect_notif">
    <p class="notif_text">Successfully connected!</p>
    <img class="notif_warn" src="Images/warning.png">
    <img id="remove_connect_1" onclick="connect_1_remove()" class="remove_notif" src="Images/remove.png">
  </div>

  <div id="Connected_0" class="connect_notif">
    <p class="notif_text">Successfully disconnected.</p>
    <img class="notif_warn" src="Images/warning.png">
    <img id="remove_connect_0" onclick="connect_0_remove()" class="remove_notif" src="Images/remove.png">
  </div>

  <div id="Connected_3" class="connect_notif">
    <p class="notif_text">Could not connect or user doesnt exist.</p>
    <img class="notif_warn" src="Images/warning.png">
    <img id="remove_connect_3" onclick="connect_3_remove()" class="remove_notif" src="Images/remove.png">
  </div>
  <!--Connection Notifs-->


  <!--Left Nav Bar-->
  <div id="Left_NavBar">
    <div id="Top_Title">
      <p id="Main_Title">Raven</p>
      <img id="Top_Logo_Main" src="Images/Logo_Small.png">
      <img id="Setting_Btn" onclick="Open_Settings()" src="Images/settings.png">


      <div id="Add_New_Tab" class="added_ip">
        <p id="Add_New_Text">Add a new user</p>
        <img id="Add_New_Img" onclick="open_new_user()" src="Images/add.png">
      </div>

      <!--
      <div id="Connect_Tab">
        <img id="Search_Ip_connect" src="Images/search.png">
        <input id="connect_IP" type="text" placeholder="Enter User ID" />
        <button id="Connect_Button">CONNECT</button>
      </div>
      -->
      <div id="Personal_Tab">
        <img class="user_img" src="Images/user.png">
        <p id="Username_Personal" class="user_ip">Username</p>
        <p id="Your_Username">Id: <span id="Your_IP_Actual"></span></p>
        <div id="Online_Indicator_Personal" class="online-indicator"></div>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Online</p>
        <p class="online-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
        <p class="Message_Count">1</p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
      </div>

      <div class="added_ip">
        <img class="user_img" src="Images/user.png">
        <p class="user_ip">00.00.0.0</p>
        <img class="delete_saved" src="Images/remove.png">
        <p class="Status_Text">Offline</p>
        <p class="offline-indicator Status_Icon"></p>
      </div>

    </div>

    <div id="Scrollable_Nav">

    </div>
  </div>
  <!--Left Nav Bar-->



  <!--Middle Nav Bar-->
  <div id="Messaging_Area">
    <video id="Msg_Video" autoplay muted loop>
      <source src="Videos/purple.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div id="Search_Bar">
      <div>

        <textarea id="Msg_Area" autocomplete="off" type="text" placeholder="Send a message"></textarea>
        <!--<img id="Send_Img" src="./Images/SendImg.png">-->

        <p id="Connected_to_text">Connected to <span id="user_id_actual"></span></p>
        <img id="leave_chat" src="Images/leave.png">
        <div id="Currently_Chatting">
          <img id="Current_User_Img" src="Images/user.png">
          <p id="Current_User_Text"></p>
        </div>
        <div id="Receive_Area">
          <ul id="Sent" class="rec_sent_style">

            <!--
              <li class="msg_style_sent">good thanks- sent<span class="sent_time">Sent: 09:49pm - 00/00/0000</span>
              <span class="loader"></span>
            </li>
            <li class="msg_style_sent">good thanks- sent<span class="sent_time">Sent: 09:49pm</span> <span
                class="loader"></span></li>
            <li class="msg_style_sent">good thanks- sent<span class="sent_time">Sent: 09:49pm</span></li>
            <li class="msg_style_sent">good thanks- sent<span class="sent_time">Sent: 09:49pm</span></li>
            <li class="msg_style_rec">good how are you - received<span class="rec_time">Received: 09:49pm</span></li>
            <li class="msg_style_sent">how are you - sent<span class="sent_time">Sent: 09:49pm</span></li>
            <li class="msg_style_rec">hi - received<span class="rec_time">Received: 09:49pm</span></li>
            <li class="msg_style_sent">hi - sent<span class="sent_time">Sent: 09:49pm</span></li>
            -->
          </ul>
        </div>
        <p id="Message">Connect to user to start chatting!</p>

        <div id="Search_Bar_Add">
          <img id="Exit_Add_New" onclick="close_new_user()" src="Images/Exit.png">
          <p id="Add_Connect_User">Add new users</p>
          <img id="Search_Ip_connect" src="Images/search.png">
          <input id="connect_IP" type="text" placeholder="Enter User ID" />
          <button id="Connect_Button">ADD</button>
        </div>

      </div>
    </div>
  </div>
  <!--Middle Nav Bar-->


  <!--Right Nav Bar-->
  <div id="Connection_Area">
    <div id="Connection_Title">
      <p id="Connection_Title_text">Connection</p>
      <div id="Offline_Status" class="offline-indicator offline"></div>
      <div id="Online_Status" class="online-indicator online"></div>
    </div>

    <div id="Connection_Information">

      <p id="Connected_to">Connected to: </p>
      <p id="Connected_to_IP">N/A</p>

      <div id="Marker"></div>

      <p id="Your_Ip">User ID: </p>


      <div id="Marker_2"></div>

      <p id="Your_Speed">Internet Speed: </p>
      <p id="Internet_Speed_Actual">000 MBps</p>
    </div>

    <div id="Disconnect">
      <button id="Disconnect_Button">Leave</button>
    </div>

  </div>
  <!--Right Nav Bar-->


  <!--offline-indicator offline-->
  <!--online-indicator online-->


  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {

      function getCurrentTime12Hour() {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes();
        const amPm = hours >= 12 ? 'PM' : 'AM';

        // Convert to 12-hour format
        hours = hours % 12 || 12;

        // Format the time as hh:mm AM/PM
        const formattedTime = `${hours < 10 ? '0' : ''}${hours}:${minutes < 10 ? '0' : ''}${minutes} ${amPm}`;

        return formattedTime;
      }


      function formatDateAsZeroes() {
        const today = new Date();
        const day = today.getDate().toString().padStart(2, '0'); // Get day with leading zero
        const month = (today.getMonth() + 1).toString().padStart(2, '0'); // Get month with leading zero
        const year = today.getFullYear().toString(); // Get full year

        const formattedDate = `${month}/${day}/${year}`;
        return formattedDate;
      }
      var socket = io();
      var form = document.getElementById('form');
      var input = document.getElementById('Msg_Area');
      var connect_btn = document.getElementById("Connect_Button");

      const Ip = document.getElementById("Your_IP_Actual");

      //Send Message--------------------------------------------------------
      var input = document.getElementById('Msg_Area');

      input.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      function sendMessage() {
        var recipientId = document.getElementById('connect_IP');
        var recipientId_value = recipientId.value;

        if (input.value) {
          console.log("ID: ", recipientId_value);
          socket.emit('chat message', { recipientId: recipientId_value, content: input.value });
        }

        var item = document.createElement('li');
        var messages = document.getElementById('Sent');
        const spanElement = document.createElement('span');

        const time = getCurrentTime12Hour();
        const date = formatDateAsZeroes();

        item.classList.add('msg_style_sent');
        item.textContent = input.value;
        spanElement.classList.add('sent_time');
        spanElement.textContent = "Sent: " + time + " - " + date;
        item.appendChild(spanElement);
        messages.appendChild(item);
        messages.scrollTop = messages.scrollHeight;
        input.value = '';
      }







      //Send Message--------------------------------------------------------

      //Check if User ID exists --------------------------------------------------------
      connect_btn.addEventListener('click', function (e) { //checks if recipient exists
        e.preventDefault();
        var recipientId = document.getElementById('connect_IP');
        var recipientId_value = recipientId.value;
        if (recipientId_value) {
          socket.emit('recipient', { recipient_id: recipientId_value });
        }
      });

      socket.on('recipient exist', function (data) {
        const recipientId = document.getElementById('connect_IP');
        const recipientId_value = recipientId.value;
        const connected_to = document.getElementById("Connected_to_text");
        const connected_to_text = document.getElementById("user_id_actual");
        const off = document.getElementById("Offline_Status");
        const on = document.getElementById("Online_Status");

        console.log(`Received message from user ${data.message}`);

        if (data.message === "1") {
          connect_1();
          connected_to_text.textContent = recipientId_value;
          connected_to.style.display = "block";
          off.style.display = "none";
          on.style.display = "block";
          console.log("we are connected");
        } else if (data.message === "0") {
          connect_3();
          off.style.display = "block";
          on.style.display = "none";
          console.log("did not connect or doesn't exist");
        }
      });
      //Check if User ID exists --------------------------------------------------------

      socket.on("")

      socket.on('chat message', function (data) {
        console.log(`Received message from user ${data.senderId}: ${data.content}`);
      });

      socket.on('user connected', function (userId) {

        console.log('Received user ID:', userId);
        Ip.textContent = userId;

      });

      //Received messages--------------------------------------------------------
      socket.on('chat message', function (data) {
        const item = document.createElement('li');
        const spanElement = document.createElement('span');
        const messages = document.getElementById('Sent');

        const time = getCurrentTime12Hour();
        const date = formatDateAsZeroes();

        item.classList.add('msg_style_rec');
        item.textContent = data.content;

        spanElement.classList.add('rec_time');
        spanElement.textContent = "Received: " + time + " - " + date;

        item.appendChild(spanElement);
        messages.appendChild(item);

        // Scroll to the bottom of the container (assuming 'Sent' is the container element)
        messages.scrollTop = messages.scrollHeight;
      });
      //Received messages--------------------------------------------------------

    });
  </script>

</body>

</script>
<script defer type="text/javascript" src="index.js"></script>

</html>